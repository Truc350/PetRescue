{% load humanize %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tím kiếm - PetRescue</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/DogKibbleView.css">
</head>
<body>
{% include "frontend/header.html" %}
<h1>
    Tìm thấy {{ total }} kết quả
    {% if keyword %}
    cho “{{ keyword }}”
    {% endif %}
</h1>

<!--Layout Chinh: Sidebar + contain -->
<div class="main-layout">
    <aside class="sidebar">
        <form method="get">
            <input type="hidden" name="q" value="{{ keyword }}">
            <div class="filter-section">

                <div class="filter-group">

                    <h3 class="filter-title"><span>Giá</span></h3>
                    <div style="text-align: right;">
                        <button type="submit"
                                class="btn btn-danger btn-sm rounded-1 px-3 shadow-none"
                                style="transform: none !important;">
                            Lọc
                        </button>
                    </div>

                    <div class="filter-list mt-2">
                        <label>
                            <input type="checkbox" name="price" value="0-100000"
                                   {% if "0-100000" in selected_prices %}checked{% endif %}>
                            &lt; 100,000
                        </label>
                        <label>
                            <input type="checkbox" name="price" value="100000-200000"
                                   {% if "100000-200000" in selected_prices %}checked{% endif %}>
                            100,000-200,000
                        </label>
                        <label><input type="checkbox" name="price" value="200000-300000"
                                      {% if "200000-300000" in selected_prices %}checked{% endif %}>
                            200,000 - 300,000</label>
                        <label><input type="checkbox" name="price" value="300000-400000"
                                      {% if "300000-400000" in selected_prices %}checked{% endif %}>
                            300,000 - 400,000</label>
                        <label><input type="checkbox" name="price" value="400000-500000"
                                      {% if "400000-500000" in selected_prices %}checked{% endif %}>
                            400,000 - 500,000</label>
                        <label><input type="checkbox" name="price" value="500000-600000"
                                      {% if "500000-600000" in selected_prices %}checked{% endif %}>
                            500,000 - 600,000</label>
                        <label><input type="checkbox" name="price" value="600000-700000"
                                      {% if "600000-700000" in selected_prices %}checked{% endif %}>
                            600,000 - 700,000</label>
                        <label><input type="checkbox" name="price" value="700000-800000"
                                      {% if "700000-800000" in selected_prices %}checked{% endif %}>
                            700,000 - 800,000</label>
                        <label><input type="checkbox" name="price" value="800000-900000"
                                      {% if "800000-900000" in selected_prices %}checked{% endif %}>
                            800,000 - 900,000</label>
                        <label><input type="checkbox" name="price" value="900000-1000000"
                                      {% if "900000-1000000" in selected_prices %}checked{% endif %}>
                            900,000 - 1,000,000</label>
                    </div>
                </div>

                <div class="filter-group">
                    <h3 class="filter-title">Thương Hiệu<span>-</span></h3>

                    <div class="filter-list">

                        <label>
                            <input type="checkbox" name="brand" value="Royal Canin"
                                   {% if "Royal Canin" in selected_brands %}checked{% endif %}>
                            Royal Canin
                        </label>

                        <label>
                            <input type="checkbox" name="brand" value="Zenith"
                                   {% if "Zenith" in selected_brands %}checked{% endif %}>
                            Zenith
                        </label>

                        <label>
                            <input type="checkbox" name="brand" value="Taste Of The Wild"
                                   {% if "Taste Of The Wild" in selected_brands %}checked{% endif %}>
                            Taste Of The Wild
                        </label>

                        <label>
                            <input type="checkbox" name="brand" value="Inaba"
                                   {% if "Inaba" in selected_brands %}checked{% endif %}>
                            Inaba
                        </label>

                        <label>
                            <input type="checkbox" name="brand" value="Equilibrio"
                                   {% if "Equilibrio" in selected_brands %}checked{% endif %}>
                            Equilibrio
                        </label>

                    </div>
                </div>


            </div>
        </form>
    </aside>

    <!--    Nội dung chính-->
    <div class="content">

        <!--toolbar sắp xếp-->
        <div class="toolbar">
            <div class="sort-by">
                <span>Sắp xếp theo:</span>
                <select>
                    <option>Bán chạy</option>
                    <option>Giá: Thấp đến cao</option>
                    <option>Giá: Cao đến thấp</option>
                </select>
            </div>
        </div>


        <section class="row g-4 section-spacing content-padding">

            {% if products %}
            {% for product in products %}
            <div class="col-lg-3 col-md-4 col-6">
                <div class="product-card bg-white rounded shadow-sm overflow-hidden">

                    <a href="{% url 'product_detail' product.slug %}">
                        <img src="{{ product.image }}"
                             class="w-100"
                             style="height: 200px; object-fit: contain;"
                             alt="{{ product.name }}">
                    </a>

                    <div class="p-3">
                        <div class="product-header d-flex justify-content-between align-items-center">
                            <p class="small text-muted mb-0 brand-name">{{ product.brand }}</p>

                            <button class="btn-wishlist" data-id="{{ product.id }}">
                                {% if product.id in liked_ids %}
                                <i class="bi bi-heart-fill text-danger"></i>
                                {% else %}
                                <i class="bi bi-heart"></i>
                                {% endif %}
                            </button>
                        </div>


                        <p class="fw-medium small line-clamp-2">
                            {{ product.name }}
                        </p>

                        <p class="text-danger fw-bold">
                            {{ product.final_price|intcomma }}đ
                        </p>

                        <a href="{% url 'orders:buy_now' product.id %}"
                           class="btn btn-danger w-100 rounded-pill py-2">
                            Mua ngay
                        </a>
                    </div>

                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-muted">
                Không tìm thấy sản phẩm nào phù hợp.
            </p>
            {% endif %}

        </section>

    </div>
</div>
</div>
<div class="support-btn">
    <i class="fas fa-comment-dots"></i> Hỗ trợ
</div>
{% include "frontend/footer.html" %}
</body>

<script>

    document.querySelectorAll(".btn-wishlist").forEach(btn => {
        btn.addEventListener("click", function () {
            const productId = this.dataset.id;

            fetch(`/wishlist/toggle/${productId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": csrftoken,
                },
            })
                .then(res => res.json())
                .then(data => {
                    const icon = this.querySelector("i");
                    if (data.liked) {
                        icon.className = "bi bi-heart-fill text-danger";
                    } else {
                        icon.className = "bi bi-heart";
                    }
                });
        });
</script>

<script>
    document.querySelectorAll('input[name="price"]').forEach(el => {
        el.addEventListener('change', function () {
            document.querySelectorAll('input[name="price"]').forEach(i => {
                if (i !== this) i.checked = false;
            });
        });
    });

    document.querySelectorAll('input[name="brand"]').forEach(el => {
        el.addEventListener('change', function () {
            document.querySelectorAll('input[name="brand"]').forEach(i => {
                if (i !== this) i.checked = false;
            });
        });
    });
</script>
<script>
document.querySelectorAll(".btn-wishlist").forEach(btn => {
    btn.addEventListener("click", function () {
        const productId = this.dataset.id;

        fetch(`/wishlist/toggle/${productId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
            },
        })
        .then(res => res.json())
        .then(data => {
            const icon = this.querySelector("i");
            if (data.liked) {
                icon.className = "bi bi-heart-fill text-danger";
            } else {
                icon.className = "bi bi-heart";
            }
        });
    });
});
</script>


</html>